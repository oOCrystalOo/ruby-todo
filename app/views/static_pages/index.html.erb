<section class="todoapp">
  <header class="header">
    <h1>todos</h1>
  </header>

  <section class="main">
    <ul class="todo-list">

    </ul>
  </section>
</section>

<script>
  $(function() {
    function toggle_task () {
      var item_id = $(this).attr('data-id');
      var _done = $(this).prop('checked');
      $.post(`/tasks/${item_id}`, {
        _method: "PUT",
        task: {
          done: _done
        }
      });
    }
    function create_list_item (task) {
      var done = task.done;
      var input = $('<input />').attr({
        type: 'checkbox',
        class: 'toggle',
        'data-id': task.id
      }).prop('checked', done).on('change', toggle_task);
      var label = $('<label></label>').html(task.title);
      var div = $('<div></div>').addClass('view').append(input, label);
      var li = $('<li></li>').append(div);
      $('ul.todo-list').append(li);
    }
    
    $.get("/tasks").success( function( data ) {
      $.each(data, function(index, task){
        create_list_item(task);
      });
    });
  });
</script>